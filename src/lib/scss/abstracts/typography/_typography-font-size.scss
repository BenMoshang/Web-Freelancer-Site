@use 'sass:math';
@use 'sass:map';
@use '../../base/global-variables' as gv;
@use '../math/responsive-functions' as math-fn;

/* ---------------------------------------------------------------------------
   1) Global / Default Variables (REM Only)
   ---------------------------------------------------------------------------
   Adjust these to match your project's design system.
--------------------------------------------------------------------------- */
$typography-base-size: 1rem; // 18px
$typography-scale-ratio: 1.2;

/* ---------------------------------------------------------------------------
   2) Typographic Scales (REM Values)
   ---------------------------------------------------------------------------
   Define your typographic scale using the base size and scale ratio.
--------------------------------------------------------------------------- */
@function calculate-font-size($step) {
	@if $step < 0 {
		@return math.div($typography-base-size, math.pow($typography-scale-ratio, abs($step)));
	} @else {
		@return math.pow($typography-scale-ratio, $step) * $typography-base-size;
	}
}

$base-typography-scale: (
	'2xs': calculate-font-size(-0.75),
	// 14px
	'xs': calculate-font-size(-0.5),
	// 16px
	'sm': calculate-font-size(0),
	// 18px
	'md': calculate-font-size(1),
	// 22px
	'lg': calculate-font-size(2),
	// 26px
	'xl': calculate-font-size(3),
	// 31px
	'2xl': calculate-font-size(4),
	// 37px
	'3xl': calculate-font-size(5),
	// 45px
	'4xl': calculate-font-size(6),
	// 54px
	'5xl': calculate-font-size(7),
	// 64px
	'6xl': calculate-font-size(8),
	// 77px
	'7xl': calculate-font-size(9),
	// 93px
	'8xl': calculate-font-size(10),
	// 111px
	'9xl': calculate-font-size(11),
	// 134px
	'10xl': calculate-font-size(12) // 160px
);
$base-typography-scale: () !default;

/* ---------------------------------------------------------------------------
   3) Static Font-Size Getter
   ---------------------------------------------------------------------------
   Retrieves a static font size from the typographic scale and rounds it.
--------------------------------------------------------------------------- */
@function get-static-fsz($size) {
	$font-size: math-fn.get-map-value($base-typography-scale, $size);

	@return math-fn.round-number($font-size, 1); // Round to whole numbers for static sizes
}

/* ---------------------------------------------------------------------------
   4) Responsive Font-Size (From Scale + Clamp)
   ---------------------------------------------------------------------------
   Blends the typographic scale with the clamp approach:
     1) Retrieves the min and max sizes from the scale.
     2) Generates a fluid clamp expression using those values.
--------------------------------------------------------------------------- */
@function create-responsive-fsz($min-key, $max-key) {
	$min-size: get-static-fsz($min-key);
	$max-size: get-static-fsz($max-key);

	@return math-fn.create-clamp($min-size, $max-size);
}

$responsive-font-sizes: (
	'display--h1': create-responsive-fsz('4xl', '10xl'),
	'display--h2': create-responsive-fsz('2xl', '9xl'),
	'heading--h2': create-responsive-fsz('lg', '5xl'),
	'heading--h3': create-responsive-fsz('lg', '2xl'),
	'heading--h4': create-responsive-fsz('md', 'xl'),
	'body--lg': create-responsive-fsz('md', 'lg'),
	'body--md': create-responsive-fsz('sm', 'md'),
	'label': create-responsive-fsz('xs', 'sm')
);

@function get-responsive-fsz($key) {
	@if map-has-key($responsive-font-sizes, $key) {
		@return map.get($responsive-font-sizes, $key);
	} @else {
		@error "Key '#{$key}' not found in $responsive-font-sizes map";
		@return null;
	}
}

@mixin apply-fsz($size, $static: false) {
	@if type-of($size) != 'string' {
		@error "Font size must be a string. Got: #{$size}";
	}

	@if $static == true {
		font-size: get-static-fsz($size);
	} @else {
		@if map-has-key($responsive-font-sizes, $size) {
			font-size: get-responsive-fsz($size);
		} @else {
			@error "Invalid font size '#{$size}'. Available sizes are: #{map.keys($responsive-font-sizes)}";
		}
	}
}
